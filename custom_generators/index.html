
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Custom Generators - Essential Ruby / Rails Knowledge</title>
  <meta name="author" content="xdite">

  
  <meta name="description" content="        Custom Generators      Oct 18th, 2011      說明自從 Rails 3.0 之後，Generators 寫作方式開始基於 Thor。Thor 提供了一系列利於處理檔案的 API 。Getting Startedrails generate...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://techbang.github.com/erk/custom_generators/">
  <link href="/erk/favicon.png" rel="icon">
  <link href="/erk/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/erk/javascripts/modernizr-2.0.js"></script>
  <script src="/erk/javascripts/ender.js"></script>
  <script src="/erk/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/erk/atom.xml" rel="alternate" title="Essential Ruby / Rails Knowledge" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/erk/">Essential Ruby / Rails Knowledge</a></h1>
  
    <h2>something you should know</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/erk/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:techbang.github.com/erk" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/erk/">Blog</a></li>
  <li><a href="/erk/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">Custom Generators</h1>
    <p class="meta">





  



<time datetime="2011-10-18T12:22:00+08:00" pubdate  data-updated="true" >Oct 18<span>th</span>, 2011</time></p>
  </header>
  
  <h2>說明</h2>

<p>自從 Rails 3.0 之後，Generators 寫作方式開始基於 <a href="https://github.com/wycats/thor">Thor</a>。Thor 提供了一系列利於處理檔案的 API 。</p>

<h2>Getting Started</h2>

<p><code>rails generate</code> 是 Rails 的 generator 指令。</p>

<p>你可以利用這個指令，搭配 Rails 內建或 Gem 提供的 generator，快速產生需要的檔案。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Usage: rails generate GENERATOR [args] [options]
</span><span class='line'>
</span><span class='line'>General options:
</span><span class='line'>  -h, [--help]     # Print generator's options and usage
</span><span class='line'>  -p, [--pretend]  # Run but do not make any changes
</span><span class='line'>  -f, [--force]    # Overwrite files that already exist
</span><span class='line'>  -s, [--skip]     # Skip files that already exist
</span><span class='line'>  -q, [--quiet]    # Suppress status output
</span><span class='line'>
</span><span class='line'>Please choose a generator below.
</span><span class='line'>
</span><span class='line'>Rails:
</span><span class='line'>  assets
</span><span class='line'>  controller
</span><span class='line'>  generator
</span><span class='line'>  helper
</span><span class='line'>  integration_test
</span><span class='line'>  mailer
</span><span class='line'>  migration
</span><span class='line'>  model
</span><span class='line'>  observer
</span><span class='line'>  performance_test
</span><span class='line'>  plugin
</span><span class='line'>  resource
</span><span class='line'>  scaffold
</span><span class='line'>  scaffold_controller
</span><span class='line'>  session_migration
</span><span class='line'>
</span><span class='line'>Coffee:
</span><span class='line'>  coffee:assets
</span><span class='line'>
</span><span class='line'>Jquery:
</span><span class='line'>  jquery:install
</span><span class='line'>
</span><span class='line'>Js:
</span><span class='line'>  js:assets</span></code></pre></td></tr></table></div></figure>


<h3>開始建造第一支 Generator</h3>

<p>不過在這裡我們要作的是，產生一支自己寫的 Generator。以產生一支 Initializer 為例。</p>

<p><code>$ rails generate generator Initializer</code></p>

<p>便會在 Rails project 下產生這些檔案 :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  create  lib/generators/initializer
</span><span class='line'>  create  lib/generators/initializer/initializer_generator.rb
</span><span class='line'>  create  lib/generators/initializer/USAGE
</span><span class='line'>  create  lib/generators/initializer/templates</span></code></pre></td></tr></table></div></figure>


<blockquote><p>Note : <code>$ rails generate generator</code> 可以觀看詳細說明：</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Usage:
</span><span class='line'>  rails generate generator NAME [options]
</span><span class='line'>
</span><span class='line'>Options:
</span><span class='line'>  [--namespace]       # Namespace generator under lib/generators/name
</span><span class='line'>                      # Default: true
</span><span class='line'>  [--skip-namespace]  # Skip namespace (affects only isolated applications)
</span><span class='line'>  [--old-style-hash]  # Force using old style hash (:foo =&gt; 'bar') on Ruby &gt;= 1.9
</span><span class='line'>
</span><span class='line'>Runtime options:
</span><span class='line'>  -q, [--quiet]    # Supress status output
</span><span class='line'>  -f, [--force]    # Overwrite files that already exist
</span><span class='line'>  -p, [--pretend]  # Run but do not make any changes
</span><span class='line'>  -s, [--skip]     # Skip files that already exist
</span><span class='line'>
</span><span class='line'>Description:
</span><span class='line'>    Stubs out a new generator at lib/generators. Pass the generator name as an argument,
</span><span class='line'>    either CamelCased or snake_cased.
</span><span class='line'>
</span><span class='line'>Example:
</span><span class='line'>    `rails generate generator Awesome`
</span><span class='line'>
</span><span class='line'>    creates a standard awesome generator:
</span><span class='line'>        lib/generators/awesome/
</span><span class='line'>        lib/generators/awesome/awesome_generator.rb
</span><span class='line'>        lib/generators/awesome/USAGE
</span><span class='line'>        lib/generators/awesome/templates/</span></code></pre></td></tr></table></div></figure>


<h4>解釋</h4>

<p>檔案 <code>lib/generators/initializer/initializer_generator.rb</code> :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">InitializerGenerator</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Generators</span><span class="o">::</span><span class="no">NamedBase</span>
</span><span class='line'>  <span class="n">source_root</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../templates&#39;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>這個 Generator 的名字就叫做 Initializer。若你時候再執行一次 <code>rails generate</code>。可以看到已經新增了一個 generator 叫 Initializer。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Initializer:
</span><span class='line'>  initializer</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>source_root</code> 這一行是表示 template 檔案放在這個資料夾下的 templates 資料夾下。也就是 <code>lib/generators/initializer/templates</code> 下。</li>
</ul>


<h4>Generator Template</h4>

<p>為了要了解 Generator Template 是怎麼運作的。讓我們來新增一個檔案吧 : <code>lib/generators/initializer/templates/initializer.rb</code>。</p>

<p>內容是</p>

<figure class='code'><figcaption><span>lib/generators/initializer/templates/initializer.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">API_KEY</span> <span class="o">=</span> <span class="s2">&quot;secret_number_1234&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>再修改 <code>lib/generators/initializer/initializer_generator.rb</code> 加入一行 <code>copy_file</code>。</p>

<figure class='code'><figcaption><span>lib/generators/initializer/initializer_generator.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">InitializerGenerator</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Generators</span><span class="o">::</span><span class="no">NamedBase</span>
</span><span class='line'>  <span class="n">source_root</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s2">&quot;../templates&quot;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">copy_initializer_file</span>
</span><span class='line'>    <span class="n">copy_file</span> <span class="s2">&quot;initializer.rb&quot;</span><span class="p">,</span> <span class="s2">&quot;config/initializers/</span><span class="si">#{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">.rb&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>Note : <code>copy_file</code> 是 Thor 的 API</p></blockquote>

<p>接著執行我們客製的 Generator：</p>

<p><code>$ rails generate initializer api_key</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  create  config/initializers/api_key.rb</span></code></pre></td></tr></table></div></figure>


<p>這個 Rails project 下的 <code>config/initializers</code> 目錄下就會產生一個 <code>api_key.rb</code> 。內容是由剛剛的 initializer.rb 拷貝過去的。</p>

<h3>Thor API</h3>

<p>Thor 提供了很多客製 <a href="http://rdoc.info/github/wycats/thor/master/Thor/Actions.html">API</a>，可以讓你做更多的事。</p>

<h4>gem</h4>

<p>若要在 Gemfile 下自動新增 dependency，新加入  <code>add_rspec_and_device_to_gemfile</code> 這個 method，使用 <code>gem</code> 這個 Thor API。</p>

<figure class='code'><figcaption><span>lib/generators/initializer/initializer_generator.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">InitializerGenerator</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Generators</span><span class="o">::</span><span class="no">NamedBase</span>
</span><span class='line'>  <span class="n">source_root</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s2">&quot;../templates&quot;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">copy_initializer_file</span>
</span><span class='line'>    <span class="n">copy_file</span> <span class="s2">&quot;initializer.rb&quot;</span><span class="p">,</span> <span class="s2">&quot;config/initializers/</span><span class="si">#{</span><span class="n">file_name</span><span class="si">}</span><span class="s2">.rb&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">add_rspec_and_device_to_gemfile</span>
</span><span class='line'>    <span class="n">gem</span><span class="p">(</span><span class="s2">&quot;rspec&quot;</span><span class="p">,</span> <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="ss">:version</span> <span class="o">=&gt;</span> <span class="s2">&quot;2.1.0&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">gem</span><span class="p">(</span><span class="s2">&quot;devise&quot;</span><span class="p">,</span> <span class="s2">&quot;1.1.5&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>執行： <code>$ rails generate initializer api_key</code></p>

<p>Rails project 下的 Gemfile 最底端就會自動產生這兩行：</p>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s2">&quot;rspec&quot;</span><span class="p">,</span> <span class="s2">&quot;2.1.0&quot;</span><span class="p">,</span> <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s2">&quot;test&quot;</span>
</span><span class='line'><span class="n">gem</span> <span class="s2">&quot;devise&quot;</span><span class="p">,</span> <span class="s2">&quot;1.1.5&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h4>application</h4>

<p><code>application</code> 這個 API</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">application</span> <span class="s2">&quot;config.asset_host = &#39;http://example.com&#39;&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>會自動在 <code>application.rb</code> 裡面新增 <code>config.asset_host</code>。</p>

<h4>其他</h4>

<p>其他可能會比較常用到的 API ：</p>

<ul>
<li>plugin</li>
<li>git</li>
<li>vendor</li>
<li>lib</li>
<li>rakefile</li>
<li>generate</li>
<li>rake</li>
</ul>


<h2>客製 Rails 自己的 Generators</h2>

<p>TODO</p>

<h2>撰寫 template 搭配 rails new</h2>

<p>這是一個典型的 generator template。可以搭配 <code>rails new</code> 使用</p>

<figure class='code'><figcaption><span>template.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span><span class="p">(</span><span class="s2">&quot;rspec-rails&quot;</span><span class="p">,</span> <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">gem</span><span class="p">(</span><span class="s2">&quot;cucumber-rails&quot;</span><span class="p">,</span> <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">yes?</span><span class="p">(</span><span class="s2">&quot;Would you like to install Devise?&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">gem</span><span class="p">(</span><span class="s2">&quot;devise&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">generate</span><span class="p">(</span><span class="s2">&quot;devise:install&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">model_name</span> <span class="o">=</span> <span class="n">ask</span><span class="p">(</span><span class="s2">&quot;What would you like the user model to be called? [user]&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span> <span class="k">if</span> <span class="n">model_name</span><span class="o">.</span><span class="n">blank?</span>
</span><span class='line'>  <span class="n">generate</span><span class="p">(</span><span class="s2">&quot;devise&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>執行 <code>rails new thud -m template.rb</code></p>

<p>甚至你可以把 teamplte 放在 gist 裡。</p>

<p><code>rails new thud -m https://gist.github.com/722911.txt</code></p>

<h2>客製有 Namespace 的 generator</h2>

<p><code>$ rails generate generator rails/generators/my_plugin/config</code></p>

<p>打開 <code>lib/generators/rails/generators/my_plugin/config/config_generator.rb</code></p>

<p>把內容</p>

<figure class='code'><figcaption><span>lib/generators/rails/generators/my\_plugin/config/config_generator.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Rails</span><span class="o">::</span><span class="no">Generators</span><span class="o">::</span><span class="no">MyPlugin</span><span class="o">::</span><span class="no">ConfigGenerator</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Generators</span><span class="o">::</span><span class="no">NamedBase</span>
</span><span class='line'>  <span class="n">source_root</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../templates&#39;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>替換成</p>

<figure class='code'><figcaption><span>lib/generators/rails/generators/my\_plugin/config/config_generator.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">MyPlugin</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">Generators</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">ConfigGenerator</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Generators</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>      <span class="n">source_root</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../templates&#39;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>這樣就能造出</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>MyPlugin:
</span><span class='line'>  my_plugin:config</span></code></pre></td></tr></table></div></figure>


<h4>參考資料：</h4>

<p><a href="http://stackoverflow.com/questions/3091909/creating-a-ruby-on-rails-3-gem-with-a-generator-incl-namespace">http://stackoverflow.com/questions/3091909/creating-a-ruby-on-rails-3-gem-with-a-generator-incl-namespace</a></p>

<h2>把 Genertor 包進 Rails Gem</h2>

<p>如何打包 Gem 可看 <a href="/erk/packing-gems">包裝 Gem</a> 一節。</p>

<p>現在我們要做的是把 Generator 搬到 Gem 裡面去。假設你實驗中的 gem 在同目錄下的 my_plugin 目錄下。修改 <code>Gemfile</code> 將這一行加入：</p>

<figure class='code'><figcaption><span>Gemfile</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s2">&quot;my_plugin&quot;</span><span class="p">,</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s2">&quot;../my_plugin&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>然後運行</p>

<p><code>$ bundle check</code>。</p>

<p>執行 <code>$ mv lib/generators/ ../my_plugin/lib/</code> 把寫好的 generator 搬過去。</p>

<p>這樣就完成了搬家動作。可以執行 <code>$ rails generate</code>看看</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>MyPlugin:
</span><span class='line'>  my_plugin:config</span></code></pre></td></tr></table></div></figure>


<p>是否還在。如果還在就是搬成功了。</p>

<p>待你發佈完新的 Gem，就可以把 Gemfile 中的 <code>:path =&gt;</code> 這一段拿掉。</p>

<blockquote><p>Note: <code>:path =&gt;</code> 是 Bundler 內讓開發者測試 local 開發中 Gem 的方法。</p></blockquote>

<h2>相關連結：</h2>

<ul>
<li><a href="http://guides.rubyonrails.org/generators.html">http://guides.rubyonrails.org/generators.html</a></li>
</ul>


  
    <footer>
      <p class="meta">
        
        





  



<time datetime="2011-10-18T12:22:00+08:00" pubdate  data-updated="true" >Oct 18<span>th</span>, 2011</time>
        
      </p>
      
        <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://techbang.github.com/erk/custom_generators/index.html" data-via="" data-counturl="http://techbang.github.com/erk/custom_generators/index.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

      
    </footer>
  
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/erk/redirect-to-and-respond-with/">redirect_to and respond_with</a>
      </li>
    
      <li class="post">
        <a href="/erk/builders/">builders</a>
      </li>
    
      <li class="post">
        <a href="/erk/render-text/">render text</a>
      </li>
    
      <li class="post">
        <a href="/erk/render-template/">render_template</a>
      </li>
    
      <li class="post">
        <a href="/erk/render-options/">render options</a>
      </li>
    
  </ul>
</section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - xdite -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  


<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>


  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>







</body>
</html>
